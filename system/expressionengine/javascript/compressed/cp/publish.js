/*jslint browser: true, devel: true, onevar: true, undef: true, nomen: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, strict: true, newcap: true, immed: true */
"use strict";EE.publish=EE.publish||{};EE.publish.category_editor=function(){var k=[],d=$("<div />"),b=$('<div id="cat_modal_container" />').appendTo(d),j={},g={},l=EE.BASE+"&C=admin_content&M=category_editor&group_id=",f,e,a,h;function c(){return +new Date()}d.dialog({autoOpen:false,height:450,width:600,modal:true});$(".edit_categories_link").each(function(){var i=this.href.substr(this.href.lastIndexOf("=")+1);$(this).data("gid",i);k.push(i)});for(h=0;h<k.length;h++){j[k[h]]=$("#cat_group_container_"+[k[h]]);j[k[h]].data("gid",k[h]);g[k[h]]=$("#cat_group_container_"+[k[h]]).find(".cat_action_buttons").remove()}f=function(i){j[i].text("loading...").load(l+i+"&timestamp="+c()+" .pageContents table",function(){e.call(j[i],j[i].html(),false)})};e=function(p,r){var m=$(this),q=m.data("gid");p=$.trim(p);if(m.hasClass("edit_categories_link")){m=$("#cat_group_container_"+q)}if(p[0]!=="<"&&r){return f(q)}m.closest(".cat_group_container").find("#refresh_categories").show();var s=$(p),n=s.find("form"),o,u;if(n.length){b.html(s);o=b.find("input[type=submit]");u=b.find("form");var i=function(y){var x=y||$(this),v=x.serialize(),w=x.attr("action");$.ajax({url:w,type:"POST",data:v,dataType:"html",beforeSend:function(){m.html("loading...")},success:function(A){A=$.trim(A);d.dialog("close");if(A[0]=="<"){var z=$(A).find(".pageContents table"),B=z.find("form");if(B.length==0){m.html(z)}e.call(m,z,true)}else{e.call(m,A,true)}}});return false};u.submit(i);var t={};t[o.remove().attr("value")]=function(){i(u)};d.dialog("open");d.dialog("option","buttons",t);d.one("dialogclose",function(){f(q)})}else{g[q].clone().appendTo(m).show()}return false};a=function(){var i=$(this).data("gid"),m=".pageContents";if($(this).hasClass("edit_cat_order_trigger")||$(this).hasClass("edit_categories_link")){m+=" table"}if(!i){i=$(this).closest(".cat_group_container").data("gid")}j[i].text("loading...");$.get(this.href+"&timestamp="+c()+m,function(n){var o,p="";n=$.trim(n);if(n[0]=="<"){o=$(n).find(m);p=$("<div />").append(o).html();if(o.find("form").length==0){j[i].html(p)}}e.call(j[i],p,true)});return false};$(".edit_categories_link").click(a);$(".cat_group_container a:not(.cats_done)").live("click",a);$(".cats_done").live("click",function(){var i=$(this).closest(".cat_group_container");i.text("loading...").load(EE.BASE+"&C=content_publish&M=ajax_update_cat_fields&group_id="+i.data("gid")+"&timestamp="+c(),function(m){i.html($(m).html())});return false})};EE.publish.save_layout=function(){var g=0,e={},h={},m={},j=0,i=false,a=0,k=0,b=$("#tab_menu_tabs li.current").attr("id");$(".main_tab").show();$("li","#tab_menu_tabs").each(function(){if(this.id&&this.id!==""){var n=this.id.replace(/menu_/,"");j=0;visible=true;if($(this).is(":visible")){lay_name=n;e[lay_name]={}}else{i=true;visible=false}$("#"+n).find(".publish_field").each(function(){var p=$(this),s=this.id.replace(/hold_field_/,""),r=Math.round((p.width()/p.parent().width())*10)*10,o=$("#sub_hold_field_"+s+" .markItUp ul li:eq(2)"),q;if(o.html()!=="undefined"&&o.css("display")!=="none"){o=true}else{o=false}q={visible:($(this).css("display")==="none"||visible===false)?false:true,collapse:($("#sub_hold_field_"+s).css("display")==="none")?true:false,htmlbuttons:o,width:r+"%"};if(visible===true){q.index=j;e[lay_name][s]=q;j+=1}else{h[s]=q}});if(visible===true){g++}}});if(i==true){var d,c,l,f=0;for(darn in e){l=darn;for(c in e[l]){f=e[l][c]["index"]}break}$.each(h,function(){this["index"]=++f});jQuery.extend(e[l],h)}EE.tab_focus(b.replace(/menu_/,""));if(g===0){$.ee_notice(EE.publish.lang.tab_count_zero,{type:"error"})}else{if($("#layout_groups_holder input:checked").length===0){$.ee_notice(EE.publish.lang.no_member_groups,{type:"error"})}else{$.ajax({type:"POST",dataType:"json",url:EE.BASE+"&C=content_publish&M=save_layout",data:"XID="+EE.XID+"&json_tab_layout="+JSON.stringify(e)+"&"+$("#layout_groups_holder input").serialize()+"&channel_id="+EE.publish.channel_id,success:function(n){if(n.messageType==="success"){$.ee_notice(n.message,{type:"success"})}else{if(n.messageType==="failure"){$.ee_notice(n.message,{type:"error"})}}}})}}};EE.publish.remove_layout=function(){if($("#layout_groups_holder input:checked").length===0){return $.ee_notice(EE.publish.lang.no_member_groups,{type:"error"})}var a="{}";$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=save_layout",data:"XID="+EE.XID+"&json_tab_layout="+a+"&"+$("#layout_groups_holder input").serialize()+"&channel_id="+EE.publish.channel_id+"&field_group="+EE.publish.field_group,success:function(b){$.ee_notice(EE.publish.lang.layout_removed+' <a href="javascript:location=location">'+EE.publish.lang.refresh_layout+"</a>",{duration:0,type:"success"})}})};EE.date_obj_time=(function(){var a=new Date(),d=a.getHours(),b=a.getMinutes(),c=" AM";if(b<10){b="0"+b}if(d>11){d=d-12;c=" PM"}return" '"+d+":"+b+c+"'"}());$(document).ready(function(){var d;$("#layout_group_submit").click(function(){EE.publish.save_layout();return false});$("#layout_group_remove").click(function(){EE.publish.remove_layout();return false});$(".add_author_link").click(function(){$("#add_author_dialog").dialog("open");return false});function b(e){$.get(EE.BASE+"&C=content_publish&M=remove_author",{mid:e.attr("id")});e.parent().fadeOut();$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=build_author_table",data:"is_ajax=true"+$("#publishForm").serialize(),success:function(f){$("#authorsForm").html(f);updateAuthorTable()}})}$("#author_list_sidebar .delete").click(function(){b($(this));return false});$("a.reveal_formatting_buttons").click(function(){$(this).parent().parent().children(".close_container").slideDown();$(this).hide();return false});$("#write_mode_header .reveal_formatting_buttons").hide();$("#holder").corner("bottom-left");if(EE.publish.smileys==="true"){$("a.glossary_link").click(function(){$(this).parent().siblings(".glossary_content").slideToggle("fast");$(this).parent().siblings(".smileyContent .spellcheck_content").hide();return false});$("a.smiley_link").toggle(function(){$(this).parent().siblings(".smileyContent").slideDown("fast",function(){$(this).css("display","")})},function(){$(this).parent().siblings(".smileyContent").slideUp("fast")});$(this).parent().siblings(".glossary_content, .spellcheck_content").hide();$(".glossary_content a").click(function(){$.markItUp({replaceWith:$(this).attr("title")});return false})}if(EE.publish.autosave){d=function(){var e=$("#tools:visible"),f;if(e.length===1){disable_fields(true)}f=$("#publishForm").serialize();if(e.length===1){disable_fields(false)}$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=autosave_entry",data:f,success:function(g){if(isNaN(g)){if(EE.publish.autosave.error_state=="false"){$.ee_notice(g,{type:"error"});EE.publish.autosave.error_state="true"}}else{if(EE.publish.autosave.error_state=="true"){EE.publish.autosave.error_state="false"}$.ee_notice(EE.publish.autosave.success,{type:"success"})}}})};setInterval(d,1000*EE.publish.autosave.interval)}$(".markItUp ul").append('<li class="btn_plus"><a title="'+EE.lang.add_new_html_button+'" href="'+EE.BASE+"&C=myaccount&M=html_buttons&id="+EE.user_id+'">+</a></li>');$(".btn_plus a").click(function(){return confirm(EE.lang.confirm_exit,"")});$(".markItUpHeader ul").prepend('<li class="close_formatting_buttons"><a href="#"><img width="10" height="10" src="'+EE.THEME_URL+'images/publish_minus.gif" alt="Close Formatting Buttons"/></a></li>');$(".close_formatting_buttons a").toggle(function(){$(this).parent().parent().children(":not(.close_formatting_buttons)").hide();$(this).parent().parent().css("height","13px");$(this).children("img").attr("src",EE.THEME_URL+"images/publish_plus.png")},function(){$(this).parent().parent().children().show();$(this).parent().parent().css("height","22px");$(this).children("img").attr("src",EE.THEME_URL+"images/publish_minus.gif")});if(EE.publish.pages){var c=$("#pages_uri"),a=EE.publish.pages.pagesUri;if(!c.value){c.val(a)}c.focus(function(){if(this.value===a){$(this).val("")}}).blur(function(){if(this.value===""){$(this).val(a)}})}});file_manager_context="";function disable_fields(c){var a=$(".main_tab input, .main_tab textarea, .main_tab select, #submit_button"),b=$("#submit_button"),d=$("#holder").find("a");if(c){a.attr("disabled",true);b.addClass("disabled_field");d.addClass("admin_mode");$("#holder div.markItUp, #holder p.spellcheck").each(function(){$(this).before('<div class="cover" style="position:absolute;width:100%;height:50px;z-index:9999;"></div>').css({})})}else{a.removeAttr("disabled");b.removeClass("disabled_field");d.removeClass("admin_mode");$(".cover").remove()}}function removeAuthor(a){$.get(EE.BASE+"&C=content_publish&M=remove_author",{mid:a.attr("id")});a.parent().fadeOut()}function updateAuthorTable(){$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=build_author_table",data:"XID="+EE.XID+"&is_ajax=true",success:function(a){$("#authorsForm").html(a)}});$(".add_author_modal").bind("click",function(a){add_authors_sidebar(this)})}function add_authors_sidebar(b){var a=$(b).attr("id").substring(16);$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=build_author_sidebar",data:"XID="+EE.XID+"&author_id="+a,success:function(c){$("#author_list_sidebar").append(c).fadeIn();updateAuthorTable()}})}function liveUrlTitle(){var e="",b=EE.publish.word_separator,d=document.getElementById("title").value||"",a=document.getElementById("url_title"),h=new RegExp(b+"{2,}","g"),i=(b!=="_")?/\_/g:/\-/g,j="",g,f;if(e!==""){if(d.substr(0,e.length)===e){d=d.substr(e.length)}}d=d.toLowerCase().replace(i,b);for(g=0;g<d.length;g++){f=d.charCodeAt(g);if(f>=32&&f<128){j+=d.charAt(g)}else{if(f in EE.publish.foreignChars){j+=EE.publish.foreignChars[f]}}}d=j;d=d.replace("/<(.*?)>/g","");d=d.replace(/\s+/g,b);d=d.replace(/\//g,b);d=d.replace(/[^a-z0-9\-\._]/g,"");d=d.replace(/\+/g,b);d=d.replace(h,b);d=d.replace(/^[-_]|[-_]$/g,"");d=d.replace(/\.+$/g,"");if(a){a.value=d}};