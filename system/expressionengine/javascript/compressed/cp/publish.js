EE.publish=EE.publish||{};EE.publish.category_editor=function(){var e=[],c={},d=EE.BASE+"&C=admin_content&M=category_editor&group_id=";function a(){return +new Date}$(".edit_categories_link").each(function(){var f=this.href.substr(this.href.lastIndexOf("=")+1);$(this).data("gid",f);e.push(f)});for(i=0;i<e.length;i++){c[e[i]]=$("#cat_group_container_"+[e[i]]);c[e[i]].data("gid",e[i])}refresh_cats=function(f){c[f].text("loading...").load(d+f+"&timestamp="+a()+" .pageContents",function(g){setup_page(g,false)})};setup_page=function(g,h){if(g[0]!="<"&&h){return refresh_cats($(this).closest(".cat_group_container").data("gid"))}var f=$(this);f.parent().find("#refresh_categories").show();f.find("form").submit(function(){var l=$(this),j=l.serialize(),k=l.attr("action");$.ajax({url:k,type:"POST",data:j,dataType:"html",beforeSend:function(){f.html("loading...")},success:function(m){f.html($(m).find(".pageContents"));setup_page.call(f)}});return false});return false};function b(){var f=$(this).data("gid");if(!f){f=$(this).closest(".cat_group_container").data("gid")}c[f].text("loading...").load(this.href+"&modal=yes&timestamp="+a()+" .pageContents",setup_page);return false}$(".edit_categories_link").click(b);$.each(c,function(){this.find("a").live("click",b)});$("a#refresh_categories","#sub_hold_field_category").live("click",function(){var f=$(this).hide().nextAll("div");f.text("loading...").load(EE.BASE+"&C=content_publish&M=ajax_update_cat_fields&group_id="+f.data("gid")+"&timestamp="+a());return false})};EE.publish.save_layout=function(){var a=0,c={},b=$("#tab_menu_tabs li.current").attr("id");$(".main_tab").show();$("li:visible","#tab_menu_tabs").each(function(){if(this.id&&this.id!=""){var d=this.id.replace(/menu_/,"");c[d]={};$("#"+d).find(".publish_field").each(function(){var e=$(this);id=this.id.replace(/hold_field_/,""),percent_width=Math.round((e.width()/e.parent().width())*10)*10,temp_buttons=$("#sub_hold_field_"+id+" .markItUp ul li:eq(2)");if(temp_buttons.html()!="undefined"&&temp_buttons.css("display")!="none"){temp_buttons=true}else{temp_buttons=false}c[d][id]={visible:($(this).css("display")=="none")?false:true,collapse:($("#sub_hold_field_"+id).css("display")=="none")?true:false,htmlbuttons:temp_buttons,width:percent_width+"%"}});a++}});EE.tab_focus(b.replace(/menu_/,""));if(a==0){$.ee_notice(EE.publish.lang.tab_count_zero,{type:"error"})}else{if($("#layout_groups_holder input:checked").length==0){$.ee_notice(EE.publish.lang.no_member_groups,{type:"error"})}else{$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=save_layout",data:"XID="+EE.XID+"&json_tab_layout="+JSON.stringify(c)+"&"+$("#layout_groups_holder input").serialize()+"&channel_id="+EE.publish.channel_id,success:function(d){$.ee_notice(d,{type:"success"})}})}}};EE.publish.remove_layout=function(){if($("#layout_groups_holder input:checked").length==0){return $.ee_notice(EE.publish.lang.no_member_groups,{type:"error"})}var a="{}";$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=save_layout",data:"XID="+EE.XID+"&json_tab_layout="+a+"&"+$("#layout_groups_holder input").serialize()+"&channel_id="+EE.publish.channel_id+"&field_group="+EE.publish.field_group,success:function(b){$.ee_notice(EE.publish.lang.layout_removed+' <a href="javascript:location=location">'+EE.publish.lang.refresh_layout+"</a>",{duration:0,type:"success"})}})};$(document).ready(function(){var a=new Date(),e=a.getHours(),c=a.getMinutes();if(c<10){c="0"+c}if(e>11){e=e-12;date_obj_am_pm=" PM"}else{date_obj_am_pm=" AM"}EE.date_obj_time=" '"+e+":"+c+date_obj_am_pm+"'";$("#layout_group_submit").click(function(){EE.publish.save_layout();return false});$("#layout_group_remove").click(function(){EE.publish.remove_layout();return false});$(".add_author_link").click(function(){$("#add_author_dialog").dialog("open");return false});function d(h){$.get(EE.BASE+"&C=content_publish&M=remove_author",{mid:h.attr("id")});h.parent().fadeOut();$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=build_author_table",data:"is_ajax=true"+$("#publishForm").serialize(),success:function(j){$("#authorsForm").html(j);updateAuthorTable()}})}$("#author_list_sidebar .delete").click(function(){d($(this));return false});$("a.reveal_formatting_buttons").click(function(){$(this).parent().parent().children(".close_container").slideDown();$(this).hide();return false});$("#write_mode_header .reveal_formatting_buttons").hide();$("#write_mode_writer").corner("15px");$("#holder").corner("bottom-left");if(EE.publish.smileys=="true"){$("a.glossary_link").click(function(){$(this).parent().siblings(".glossary_content").slideToggle("fast");$(this).parent().siblings(".smileyContent .spellcheck_content").hide();return false});$("a.smiley_link").toggle(function(){$(this).parent().siblings(".smileyContent").slideDown("fast",function(){$(this).css("display","")})},function(){$(this).parent().siblings(".smileyContent").slideUp("fast")});$(this).parent().siblings(".glossary_content, .spellcheck_content").hide();$(".glossary_content a").click(function(){$.markItUp({replaceWith:$(this).attr("title")});return false})}if(EE.publish.autosave){function g(){if($("#tools:visible").length==1){disable_fields(true)}var h=$("#publishForm").serialize();if($("#tools:visible").length==1){disable_fields(false)}$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=autosave_entry",data:h,success:function(j){if(isNaN(j)){$.ee_notice(j,{type:"error"})}else{$.ee_notice(EE.publish.autosave.success,{type:"success"})}}})}}$(".markItUp ul").append('<li class="btn_plus"><a title="'+EE.lang.add_new_html_button+'" href="'+EE.BASE+"&C=myaccount&M=html_buttons&id="+EE.user_id+'">+</a></li>');$(".btn_plus a").click(function(){return confirm(EE.lang.confirm_exit,"")});$(".markItUpHeader ul").prepend('<li class="close_formatting_buttons"><a href="#"><img width="10" height="10" src="'+EE.THEME_URL+'images/publish_minus.gif" alt="Close Formatting Buttons"/></a></li>');$(".close_formatting_buttons a").toggle(function(){$(this).parent().parent().children(":not(.close_formatting_buttons)").hide();$(this).parent().parent().css("height","13px");$(this).children("img").attr("src",EE.THEME_URL+"images/publish_plus.png")},function(){$(this).parent().parent().children().show();$(this).parent().parent().css("height","22px");$(this).children("img").attr("src",EE.THEME_URL+"images/publish_minus.gif")});if(EE.publish.pages){var f=$("#pages_uri"),b=EE.publish.pages.pagesUri;if(!f.value){f.val(b)}f.focus(function(){if(this.value==b){$(this).val("")}}).blur(function(){if(this.value==""){$(this).val(b)}})}});file_manager_context="";function disable_fields(a){if(a){$(".main_tab input, .main_tab textarea, .main_tab select, #submit_button").attr("disabled",true);$("#submit_button").addClass("disabled_field");$("#holder a").addClass("admin_mode");$("#holder div.markItUp, #holder p.spellcheck").each(function(){$(this).before('<div class="cover" style="position:absolute;width:100%;height:50px;z-index:9999;"></div>').css({})})}else{$(".main_tab input, .main_tab textarea, .main_tab select, #submit_button").removeAttr("disabled");$("#submit_button").removeClass("disabled_field");$("#holder a").removeClass("admin_mode");$(".cover").remove()}}function removeAuthor(a){$.get(EE.BASE+"&C=content_publish&M=remove_author",{mid:a.attr("id")});a.parent().fadeOut()}function updateAuthorTable(){$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=build_author_table",data:"XID="+EE.XID+"&is_ajax=true",success:function(a){$("#authorsForm").html(a)}});$(".add_author_modal").bind("click",function(a){add_authors_sidebar(this)})}function add_authors_sidebar(b){var a=$(b).attr("id").substring(16);$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=build_author_sidebar",data:"XID="+EE.XID+"&author_id="+a,success:function(c){$("#author_list_sidebar").append(c).fadeIn();updateAuthorTable()}})}function liveUrlTitle(){var b="",e=document.getElementById("title").value;if(b!=""){if(e.substr(0,b.length)==b){e=e.substr(b.length)}}e=e.toLowerCase();var f=EE.publish.word_separator;if(f!="_"){e=e.replace(/\_/g,f)}else{e=e.replace(/\-/g,f)}var a="";for(var h=0;h<e.length;h++){var g=e.charCodeAt(h);if(g>=32&&g<128){a+=e.charAt(h)}else{if(g in EE.publish.foreignChars){a+=EE.publish.foreignChars[g]}}}var d=new RegExp(f+"{2,}","g");e=a;e=e.replace("/<(.*?)>/g","");e=e.replace(/\s+/g,f);e=e.replace(/\//g,f);e=e.replace(/[^a-z0-9\-\._]/g,"");e=e.replace(/\+/g,f);e=e.replace(d,f);e=e.replace(/^[-_]|[-_]$/g,"");e=e.replace(/\.+$/g,"");if(document.getElementById("url_title")){document.getElementById("url_title").value=""+e}}var selField=false,selMode="normal";function setFieldName(a){if(a!=selField){selField=a;clear_state();tagarray=new Array();usedarray=new Array();running=0}}function taginsert(item,tagOpen,tagClose){var which=eval("item.name");if(!selField){$.ee_notice(no_cursor);return false}var theSelection=false,result=false,theField=document.getElementById("entryform")[selField];if(selMode=="guided"){data=prompt(enter_text,"");if((data!=null)&&(data!="")){result=tagOpen+data+tagClose}}if(document.selection){theSelection=document.selection.createRange().text;theField.focus();if(theSelection){document.selection.createRange().text=(result==false)?tagOpen+theSelection+tagClose:result}else{document.selection.createRange().text=(result==false)?tagOpen+tagClose:result}theSelection="";theField.blur();theField.focus();return}else{if(!isNaN(theField.selectionEnd)){var newStart,scrollPos=theField.scrollTop,selLength=theField.textLength,selStart=theField.selectionStart,selEnd=theField.selectionEnd;if(selEnd<=2&&typeof(selLength)!="undefined"){selEnd=selLength}var s1=(theField.value).substring(0,selStart);var s2=(theField.value).substring(selStart,selEnd);var s3=(theField.value).substring(selEnd,selLength);if(result==false){newStart=selStart+tagOpen.length+s2.length+tagClose.length;theField.value=(result==false)?s1+tagOpen+s2+tagClose+s3:result}else{newStart=selStart+result.length;theField.value=s1+result+s3}theField.focus();theField.selectionStart=newStart;theField.selectionEnd=newStart;theField.scrollTop=scrollPos;return}else{if(selMode=="guided"){curField=document.submit_post[selfField];curField.value+=result;curField.blur();curField.focus();return}}}if(item=="other"){eval("document.getElementById('entryform')."+selField+".value += tagOpen")}else{if(eval(which)==0){var result=tagOpen;eval("document.getElementById('entryform')."+selField+".value += result");eval(which+" = 1");arraypush(tagarray,tagClose);arraypush(usedarray,which);running++;styleswap(which)}else{n=0;for(i=0;i<tagarray.length;i++){if(tagarray[i]==tagClose){n=i;running--;while(tagarray[n]){closeTag=arraypop(tagarray);eval("document.getElementById('entryform')."+selField+".value += closeTag")}while(usedarray[n]){clearState=arraypop(usedarray);eval(clearState+" = 0");document.getElementById(clearState).className="htmlButtonA"}}}if(running<=0&&document.getElementById("close_all").className=="htmlButtonB"){document.getElementById("close_all").className="htmlButtonA"}}}curField=eval("document.getElementById('entryform')."+selField);curField.blur();curField.focus()};