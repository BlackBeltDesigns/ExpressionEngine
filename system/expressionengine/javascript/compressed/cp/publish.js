/*jslint browser: true, devel: true, onevar: true, undef: true, nomen: true, eqeqeq: true, plusplus: true, bitwise: true, regexp: true, strict: true, newcap: true, immed: true */
"use strict";EE.publish=EE.publish||{};EE.publish.category_editor=function(){var h=[],e={},f=EE.BASE+"&C=admin_content&M=category_editor&group_id=",d,g,c,b;function a(){return +new Date()}$(".edit_categories_link").each(function(){var i=this.href.substr(this.href.lastIndexOf("=")+1);$(this).data("gid",i);h.push(i)});for(b=0;b<h.length;b++){e[h[b]]=$("#cat_group_container_"+[h[b]]);e[h[b]].data("gid",h[b])}d=function(i){e[i].text("loading...").load(f+i+"&timestamp="+a()+" .pageContents",function(j){g(j,false)})};g=function(j,k){if(j[0]!=="<"&&k){return d($(this).closest(".cat_group_container").data("gid"))}var i=$(this);i.parent().find("#refresh_categories").show();i.find("form").submit(function(){var n=$(this),l=n.serialize(),m=n.attr("action");$.ajax({url:m,type:"POST",data:l,dataType:"html",beforeSend:function(){i.html("loading...")},success:function(o){i.html($(o).find(".pageContents"));g.call(i)}});return false});return false};c=function(){var i=$(this).data("gid");if(!i){i=$(this).closest(".cat_group_container").data("gid")}e[i].text("loading...").load(this.href+"&modal=yes&timestamp="+a()+" .pageContents",g);return false};$(".edit_categories_link").click(c);$.each(e,function(){this.find("a").live("click",c)});$("a#refresh_categories","#sub_hold_field_category").live("click",function(){var i=$(this).hide().nextAll("div");i.text("loading...").load(EE.BASE+"&C=content_publish&M=ajax_update_cat_fields&group_id="+i.data("gid")+"&timestamp="+a());return false})};EE.publish.save_layout=function(){var a=0,c={},b=$("#tab_menu_tabs li.current").attr("id");$(".main_tab").show();$("li:visible","#tab_menu_tabs").each(function(){if(this.id&&this.id!==""){var d=this.id.replace(/menu_/,"");c[d]={};$("#"+d).find(".publish_field").each(function(){var f=$(this),h=this.id.replace(/hold_field_/,""),g=Math.round((f.width()/f.parent().width())*10)*10,e=$("#sub_hold_field_"+h+" .markItUp ul li:eq(2)");if(e.html()!=="undefined"&&e.css("display")!=="none"){e=true}else{e=false}c[d][h]={visible:($(this).css("display")==="none")?false:true,collapse:($("#sub_hold_field_"+h).css("display")==="none")?true:false,htmlbuttons:e,width:g+"%"}});a++}});EE.tab_focus(b.replace(/menu_/,""));if(a===0){$.ee_notice(EE.publish.lang.tab_count_zero,{type:"error"})}else{if($("#layout_groups_holder input:checked").length===0){$.ee_notice(EE.publish.lang.no_member_groups,{type:"error"})}else{$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=save_layout",data:"XID="+EE.XID+"&json_tab_layout="+JSON.stringify(c)+"&"+$("#layout_groups_holder input").serialize()+"&channel_id="+EE.publish.channel_id,success:function(d){$.ee_notice(d,{type:"success"})}})}}};EE.publish.remove_layout=function(){if($("#layout_groups_holder input:checked").length===0){return $.ee_notice(EE.publish.lang.no_member_groups,{type:"error"})}var a="{}";$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=save_layout",data:"XID="+EE.XID+"&json_tab_layout="+a+"&"+$("#layout_groups_holder input").serialize()+"&channel_id="+EE.publish.channel_id+"&field_group="+EE.publish.field_group,success:function(b){$.ee_notice(EE.publish.lang.layout_removed+' <a href="javascript:location=location">'+EE.publish.lang.refresh_layout+"</a>",{duration:0,type:"success"})}})};EE.date_obj_time=(function(){var a=new Date(),d=a.getHours(),b=a.getMinutes(),c=" AM";if(b<10){b="0"+b}if(d>11){d=d-12;c=" PM"}return" '"+d+":"+b+c+"'"}());$(document).ready(function(){var d;$("#layout_group_submit").click(function(){EE.publish.save_layout();return false});$("#layout_group_remove").click(function(){EE.publish.remove_layout();return false});$(".add_author_link").click(function(){$("#add_author_dialog").dialog("open");return false});function b(e){$.get(EE.BASE+"&C=content_publish&M=remove_author",{mid:e.attr("id")});e.parent().fadeOut();$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=build_author_table",data:"is_ajax=true"+$("#publishForm").serialize(),success:function(f){$("#authorsForm").html(f);updateAuthorTable()}})}$("#author_list_sidebar .delete").click(function(){b($(this));return false});$("a.reveal_formatting_buttons").click(function(){$(this).parent().parent().children(".close_container").slideDown();$(this).hide();return false});$("#write_mode_header .reveal_formatting_buttons").hide();$("#write_mode_writer").corner("15px");$("#holder").corner("bottom-left");if(EE.publish.smileys==="true"){$("a.glossary_link").click(function(){$(this).parent().siblings(".glossary_content").slideToggle("fast");$(this).parent().siblings(".smileyContent .spellcheck_content").hide();return false});$("a.smiley_link").toggle(function(){$(this).parent().siblings(".smileyContent").slideDown("fast",function(){$(this).css("display","")})},function(){$(this).parent().siblings(".smileyContent").slideUp("fast")});$(this).parent().siblings(".glossary_content, .spellcheck_content").hide();$(".glossary_content a").click(function(){$.markItUp({replaceWith:$(this).attr("title")});return false})}if(EE.publish.autosave){d=function(){var e=$("#tools:visible"),f;if(e.length===1){disable_fields(true)}f=$("#publishForm").serialize();if(e.length===1){disable_fields(false)}$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=autosave_entry",data:f,success:function(g){if(isNaN(g)){$.ee_notice(g,{type:"error"})}else{$.ee_notice(EE.publish.autosave.success,{type:"success"})}}})};setInterval(d,1000*EE.publish.autosave.success)}$(".markItUp ul").append('<li class="btn_plus"><a title="'+EE.lang.add_new_html_button+'" href="'+EE.BASE+"&C=myaccount&M=html_buttons&id="+EE.user_id+'">+</a></li>');$(".btn_plus a").click(function(){return confirm(EE.lang.confirm_exit,"")});$(".markItUpHeader ul").prepend('<li class="close_formatting_buttons"><a href="#"><img width="10" height="10" src="'+EE.THEME_URL+'images/publish_minus.gif" alt="Close Formatting Buttons"/></a></li>');$(".close_formatting_buttons a").toggle(function(){$(this).parent().parent().children(":not(.close_formatting_buttons)").hide();$(this).parent().parent().css("height","13px");$(this).children("img").attr("src",EE.THEME_URL+"images/publish_plus.png")},function(){$(this).parent().parent().children().show();$(this).parent().parent().css("height","22px");$(this).children("img").attr("src",EE.THEME_URL+"images/publish_minus.gif")});if(EE.publish.pages){var c=$("#pages_uri"),a=EE.publish.pages.pagesUri;if(!c.value){c.val(a)}c.focus(function(){if(this.value===a){$(this).val("")}}).blur(function(){if(this.value===""){$(this).val(a)}})}});file_manager_context="";function disable_fields(c){var a=$(".main_tab input, .main_tab textarea, .main_tab select, #submit_button"),b=$("#submit_button"),d=$("#holder").find("a");if(c){a.attr("disabled",true);b.addClass("disabled_field");d.addClass("admin_mode");$("#holder div.markItUp, #holder p.spellcheck").each(function(){$(this).before('<div class="cover" style="position:absolute;width:100%;height:50px;z-index:9999;"></div>').css({})})}else{a.removeAttr("disabled");b.removeClass("disabled_field");d.removeClass("admin_mode");$(".cover").remove()}}function removeAuthor(a){$.get(EE.BASE+"&C=content_publish&M=remove_author",{mid:a.attr("id")});a.parent().fadeOut()}function updateAuthorTable(){$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=build_author_table",data:"XID="+EE.XID+"&is_ajax=true",success:function(a){$("#authorsForm").html(a)}});$(".add_author_modal").bind("click",function(a){add_authors_sidebar(this)})}function add_authors_sidebar(b){var a=$(b).attr("id").substring(16);$.ajax({type:"POST",url:EE.BASE+"&C=content_publish&M=build_author_sidebar",data:"XID="+EE.XID+"&author_id="+a,success:function(c){$("#author_list_sidebar").append(c).fadeIn();updateAuthorTable()}})}function liveUrlTitle(){var e="",b=EE.publish.word_separator,d=document.getElementById("title").value||"",a=document.getElementById("url_title"),h=new RegExp(b+"{2,}","g"),i=(b!=="_")?/\_/g:/\-/g,j="",g,f;if(e!==""){if(d.substr(0,e.length)===e){d=d.substr(e.length)}}d=d.toLowerCase().replace(i,b);for(g=0;g<d.length;g++){f=d.charCodeAt(g);if(f>=32&&f<128){j+=d.charAt(g)}else{if(f in EE.publish.foreignChars){j+=EE.publish.foreignChars[f]}}}d=j;d=d.replace("/<(.*?)>/g","");d=d.replace(/\s+/g,b);d=d.replace(/\//g,b);d=d.replace(/[^a-z0-9\-\._]/g,"");d=d.replace(/\+/g,b);d=d.replace(h,b);d=d.replace(/^[-_]|[-_]$/g,"");d=d.replace(/\.+$/g,"");if(a){a.value=d}};