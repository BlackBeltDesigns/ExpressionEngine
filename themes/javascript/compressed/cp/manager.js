/*!
 * ExpressionEngine - by EllisLab
 *
 * @package		ExpressionEngine
 * @author		EllisLab Dev Team
 * @copyright	Copyright (c) 2003 - 2013, EllisLab, Inc.
 * @license		http://ellislab.com/expressionengine/user-guide/license.html
 * @link		http://ellislab.com
 * @since		Version 2.0
 * @filesource
 */

function _access_edit_ajax(a,b,e,g){var h="";switch(g){case "no_auth_bounce":h=jQuery.param({template_id:b,no_auth_bounce:a.val()});break;case "enable_http_auth":h=jQuery.param({template_id:b,enable_http_auth:a.val()});break;case "access":g=!$(a).closest(".accessTable").length?$(".no_auth_bounce").val():$(a).closest(".accessTable").find(".no_auth_bounce").val(),h=jQuery.param({template_id:b,member_group_id:e,new_status:a.val(),no_auth_bounce:g})}$.ajax({type:"POST",url:EE.access_edit_url,data:"is_ajax=TRUE&XID="+
EE.XID+"&"+h,success:function(a){""!==a&&$.ee_notice(a,{duration:3E3,type:"success"})},error:function(a){""!==a.responseText&&$.ee_notice(a.responseText,{duration:3E3,type:"error"})}})}function refresh_prefs_ajax(a){$.ajax({type:"GET",url:EE.template_prefs_url,data:"is_ajax=TRUE&group_id="+a,dataType:"json",success:function(a){EE.pref_json=a}})}
function access_edit_ajax(a){var b,e;"no_auth_bounce"===a.attr("name").substr(0,14)?(e=a.attr("name").substr(15)?a.attr("name").substr(15):$("input:hidden[name=template_id]").val(),_access_edit_ajax(a,e,"","no_auth_bounce")):"enable_http_auth"===a.attr("name").substr(0,16)?(e=a.attr("name").substr(17)?a.attr("name").substr(17):$("input:hidden[name=template_id]").val(),_access_edit_ajax(a,e,"","enable_http_auth")):(b=a.attr("name").replace("access_","").split("_"),e=2>b.length?$("input:hidden[name=template_id]").val():
b[1],_access_edit_ajax(a,e,b[0],"access"))}
function template_edit_ajax(){var a=$(this).closest(".accessRowHeader"),b,e,g,h,i,d,c,k,j,f;1>a.length&&(a=$(this).closest(".templateEditorTable"));b=a.data("ajax_ids");if(!b)return $(this).hasClass("ignore_radio")?!1:access_edit_ajax($(this));e=b.id;b=b.group_id;g=a.find(".template_name").val();h=a.find("select[name^=template_type]").val();i=a.find("select[name^=cache]").val();d=a.find(".refresh").val();c=a.find("select[name^=allow_php]").val();k=a.find("select[name^=php_parse_location]").val();j=
a.find(".hits").val();f=a.find(".template_size").val();a=jQuery.param({template_id:e,group_id:b,template_name:g,template_type:h,cache:i,refresh:d,hits:j,allow_php:c,php_parse_location:k,template_size:f});$.ajax({type:"POST",url:EE.template_edit_url,data:"is_ajax=TRUE&XID="+EE.XID+"&"+a,success:function(a){var c=$("#templateId_"+e);c.text(g);c.closest(".templateName").length?(c=c.closest(".templateName").next().find("a"),c.length&&(c=c.get(0),c.href=c.href.replace(/\/[^\/]*$/,"/"+g))):$("#templateViewLink a.submit").length&&
(c=$("#templateViewLink a.submit"),c.length&&(c=c.get(0),c.href=c.href.replace(/\/[^\/]*$/,"/"+g)));$("#template_data").attr("rows",f);$("#hitsId_"+e).text(j);""!==a&&$.ee_notice(a,{duration:3E3,type:"success"})},error:function(a){""!==a.responseText&&$.ee_notice(a.responseText,{duration:3E3,type:"error"})}})}function hideSubRows(a,b){b?$(a).data(b)&&$(a).data(b).hide():(hideSubRows(a,"prefsRow"),hideSubRows(a,"accessRow"))}
function hideRow(a,b){a.hasClass("highlightRow")&&a.removeClass("highlightRow");if(a.data(b)){var e=a.data(b).is(":visible");hideSubRows(a);e||(a.addClass("highlightRow"),a.data(b).show());return!0}hideSubRows(a);return!1}function set_radio_buttons(a,b){a.find("input:radio").each(function(){var a,g;a=$(this).attr("id").split("_");g=a.slice(0,-1).join("_");a=a.slice(-1)[0];$(this).attr({id:g+"_"+b+"_"+a,name:g+"_"+b})})}
function bind_prefs_events(){$(".templateTable .accessTable").find("input:text").unbind("blur.manager_updated").bind("blur.manager_updated",template_edit_ajax);$(".templateTable .accessTable").find("input:radio").unbind("click.manager_updated").bind("click.manager_updated",template_edit_ajax);$(".templateTable .accessTable").find("select").unbind("change.manager_updated").bind("change.manager_updated",template_edit_ajax)}
(function(a){var b,e;a(document).ready(function(){function g(c,b){var d="input:radio[id$=_";b&&(d="input:radio[id$=_"+b+"_");c.find(".ignore_radio").click(function(){"y"===this.value&&c.find(d+"y]").filter(":not(.ignore_radio)").trigger("click");"n"===this.value&&c.find(d+"n]").filter(":not(.ignore_radio)").trigger("click");a(this).attr("checked",!1);return!1})}var h,i,d;b=a("#prefRowTemplate").html();e=a("#accessRowTemplate").html();!b||!e?(h=a("#templateAccess, #templatePreferences"),i=a("input:hidden[name=template_id]").val(),
d=a("input:hidden[name=group_id]").val(),a("#templatePreferences").data("ajax_ids",{id:i,group_id:d}),g(a("#templateAccess")),h.find("input:text").unbind("blur.manager_updated").bind("blur.manager_updated",template_edit_ajax),h.find("input:radio").unbind("click.manager_updated").bind("click.manager_updated",template_edit_ajax),h.find("select").unbind("change.manager_updated").bind("change.manager_updated",template_edit_ajax)):(a("#prefRowTemplate, #accessRowTemplate").remove(),EE.manager={refreshPrefs:function(a){refresh_prefs_ajax(a)},
showPrefsRow:function(c,d){var j=a(d).parent().parent();if(!hideRow(j,"prefsRow")){var f=a('<tr class="accessRowHeader"><td colspan="6">'+b+"</td></tr>");f.find("select").each(function(){var d=a(this);switch(this.name){case "template_type":d.val(c.type);break;case "cache":d.val(c.cache);break;case "allow_php":d.val(c.allow_php);break;case "php_parse_location":d.val(c.php_parsing)}d.attr("name",this.name+"_"+c.id)});f.find(".template_name").val(c.name);"index"===c.name&&f.find(".template_name").attr({readonly:"readonly"});
f.find(".refresh").val(c.refresh);f.find(".hits").val(c.hits);f.data("ajax_ids",{id:c.id,group_id:c.group_id});j.data("prefsRow",f);a(j).addClass("highlightRow");a(j).after(f);bind_prefs_events()}return!1},showAccessRow:function(c,d,b){b=a(b).parent().parent();if(!hideRow(b,"accessRow")){var f=a('<tr class="accessRowHeader"><td colspan="6">'+e+"</td></tr>");f.find(".no_auth_bounce").val(d.no_auth_bounce);f.find(".no_auth_bounce").attr({id:"no_auth_bounce_"+c,name:"no_auth_bounce_"+c});f.find(".enable_http_auth").val(d.enable_http_auth);
f.find(".enable_http_auth").attr({id:"enable_http_auth_"+c,name:"enable_http_auth_"+c});set_radio_buttons(f,c);a.each(d.access,function(a,d){var b=f.find("#access_"+a+"_"+c+"_y"),g=f.find("#access_"+a+"_"+c+"_n");!0===d.access?(b.attr("checked","checked"),g.attr("checked",!1)):(g.attr("checked","checked"),b.attr("checked",!1))});g(f,c);a(b).addClass("highlightRow");a(b).after(f);f.find(".accessTable").tablesorter({widgets:["zebra"]});b.data("accessRow",f);bind_prefs_events();b.trigger("applyWidgets")}return!1}})});
a(".last_edit").css("opacity",0).show();a("#template_details").hover(function(){a(".last_edit").animate({opacity:1},50)},function(){a(".last_edit").animate({opacity:0},50)});a(document).ready(function(){if(EE.manager&&EE.manager.warnings){a(".warning_details").hide();a(".toggle_warning_details").click(function(){a(".warning_details").hide();a("#wd_"+this.id.substr(3)).show();return!1});var b=a("#template_data"),e,i;i=function(b,c,e){var g,f="";e&&1<e.length&&(f='<select name="fr_options" id="fr_options"></select>');
g='<div style="padding: 5px;"><label>Find:</label> <input name="fr_find" id="fr_find" type="text" value="" /> <label>Replace:</label> <input type="text" name="fr_replace" id="fr_replace" value=""/> '+f+'</div><div style="padding: 5px;"><button class="submit" id="fr_find_btn">Find Next</button> <button class="submit" id="fr_replace_btn">Replace</button> <button class="submit" id="fr_replace_all_btn">Replace All</button> <label><input name="fr_replace_closing_tags" id="fr_replace_closing_tags" type="checkbox" /> Include Closing Tags</label></div>';
a.ee_notice(g,{type:"custom",open:!0,close_on_click:!1});a("#fr_find").val(b);a("#fr_replace").val(c);a("#fr_replace_closing_tags").attr("checked",!1);""!==f&&(a("#fr_options").append(a(e)),a("#fr_options").click(function(){a("#fr_find").val(a(this).val());a("#fr_find_btn").click()}));b&&a("#fr_find_btn").click()};a("#fr_find_btn").live("click",function(){var d=a("#fr_find").val();e=b.selectNext(d).scrollToCursor()});a("#fr_replace_btn").live("click",function(){var b=a("#fr_find").val(),c=a("#fr_replace").val();
e.getSelectedText()===b&&e.replaceWith(c)});a("#fr_replace_all_btn").live("click",function(){var d=a("#fr_find").val(),c=a("#fr_replace").val();""!==jQuery.trim(d)&&(b.val(b.val().split(d).join(c)),a("#fr_replace_closing_tags").attr("checked")&&("{"===d[0]&&"{/"!==d.substr(0,2)&&(d="{/"+d.substr(1)),"{"===c[0]&&"{/"!==c.substr(0,2)&&(c="{/"+c.substr(1)),""!==jQuery.trim(d)&&b.val(b.val().split(d).join(c))))});a(".find_and_replace").click(function(){var a=this.id.substr(8),c="{exp:"+a,b="{exp:"+EE.manager.warnings[a].suggestion,
e=EE.manager.warnings[a].full_tags,f=Array(new Option(c,c)),g;if(e&&1<e.length)for(g=0;g<e.length;g++)a="{"+e[g]+"}",f.push(new Option(a,a));"{exp:"===b&&(b="");i(c,b,f);return!1})}});a("#template_keywords_reset").click(function(){a("#template_keywords").val("");a(".search form").submit()})})(jQuery);
