/*!
 * ExpressionEngine - by EllisLab
 *
 * @package		ExpressionEngine
 * @author		EllisLab Dev Team
 * @copyright	Copyright (c) 2003 - 2013, EllisLab, Inc.
 * @license		http://ellislab.com/expressionengine/user-guide/license.html
 * @link		http://ellislab.com
 * @since		Version 2.0
 * @filesource
 */

function refresh_prefs_ajax(a){$.ajax({type:"GET",url:EE.template_prefs_url,data:"is_ajax=TRUE&group_id="+a,dataType:"json",success:function(a){EE.pref_json=a}})}
function access_edit_ajax(a){var c,d,f,i=[];a.each(function(a,b){b=$(b);"no_auth_bounce"===b.attr("name").substr(0,14)?(c=b.attr("name").substr(15)?b.attr("name").substr(15):$("input:hidden[name=template_id]").val(),i.push({template_id:c,no_auth_bounce:b.val()})):"enable_http_auth"===b.attr("name").substr(0,16)?(c=b.attr("name").substr(17)?b.attr("name").substr(17):$("input:hidden[name=template_id]").val(),i.push({template_id:c,enable_http_auth:b.val()})):"template_route"===b.attr("name").substr(0,
14)?(c=b.attr("name").substr(15)?b.attr("name").substr(15):$("input:hidden[name=template_id]").val(),i.push({template_id:c,template_route:b.val()})):"route_required"===b.attr("name").substr(0,14)?(c=b.attr("name").substr(15)?b.attr("name").substr(15):$("input:hidden[name=template_id]").val(),i.push({template_id:c,route_required:b.val()})):(d=b.attr("name").replace("access_","").split("_"),c=2>d.length?$("input:hidden[name=template_id]").val():d[1],f=!$(b).closest(".accessTable").length?$(".no_auth_bounce").val():
$(b).closest(".accessTable").find(".no_auth_bounce").val(),b.attr("checked","checked"),i.push({template_id:c,member_group_id:d[0],new_status:b.val(),no_auth_bounce:f}))});$.ajax({type:"POST",url:EE.access_edit_url,data:{is_ajax:"TRUE",XID:EE.XID,payload:i},success:function(a){""!==a&&$.ee_notice(a,{duration:3E3,type:"success"})},error:function(a){""!==a.responseText&&$.ee_notice(a.responseText,{duration:3E3,type:"error"})}})}
function template_edit_ajax(){var a=$(this).closest(".accessRowHeader"),c,d,f,i,j,b,k,l,m,g;1>a.length&&(a=$(this).closest(".templateEditorTable"));c=a.data("ajax_ids");if(!c)return $(this).hasClass("ignore_radio")?!1:access_edit_ajax($(this));d=c.id;c=c.group_id;f=a.find(".template_name").val();i=a.find("select[name^=template_type]").val();j=a.find("select[name^=cache]").val();b=a.find(".refresh").val();k=a.find("select[name^=allow_php]").val();l=a.find("select[name^=php_parse_location]").val();
m=a.find(".hits").val();g=a.find(".template_size").val();a=jQuery.param({template_id:d,group_id:c,template_name:f,template_type:i,cache:j,refresh:b,hits:m,allow_php:k,php_parse_location:l,template_size:g});$.ajax({type:"POST",url:EE.template_edit_url,data:"is_ajax=TRUE&XID="+EE.XID+"&"+a,success:function(a){var b=$("#templateId_"+d);b.text(f);if(b.closest(".templateName").length){if(b=b.closest(".templateName").next().find("a"),b.length)b=b.get(0),b.href=b.href.replace(/\/[^\/]*$/,"/"+f)}else if($("#templateViewLink a.submit").length&&
(b=$("#templateViewLink a.submit"),b.length))b=b.get(0),b.href=b.href.replace(/\/[^\/]*$/,"/"+f);$("#template_data").attr("rows",g);$("#hitsId_"+d).text(m);""!==a&&$.ee_notice(a,{duration:3E3,type:"success"})},error:function(a){""!==a.responseText&&$.ee_notice(a.responseText,{duration:3E3,type:"error"})}})}function hideSubRows(a,c){c?$(a).data(c)&&$(a).data(c).hide():(hideSubRows(a,"prefsRow"),hideSubRows(a,"accessRow"))}
function hideRow(a,c){a.hasClass("highlightRow")&&a.removeClass("highlightRow");if(a.data(c)){var d=a.data(c).is(":visible");hideSubRows(a);d||(a.addClass("highlightRow"),a.data(c).show());return!0}hideSubRows(a);return!1}function set_radio_buttons(a,c){a.find("input:radio").each(function(){var a,f;a=$(this).attr("id").split("_");f=a.slice(0,-1).join("_");a=a.slice(-1)[0];$(this).attr({id:f+"_"+c+"_"+a,name:f+"_"+c})})}
function bind_prefs_events(){$(".templateTable .accessTable").find("input:text").unbind("blur.manager_updated").bind("blur.manager_updated",template_edit_ajax);$(".templateTable .accessTable").find("input:radio").unbind("click.manager_updated").bind("click.manager_updated",template_edit_ajax);$(".templateTable .accessTable").find("select").unbind("change.manager_updated").bind("change.manager_updated",template_edit_ajax)}
(function(a){var c,d;a(document).ready(function(){function f(b,c){var e="input:radio[id$=_";c&&(e="input:radio[id$=_"+c+"_");b.find(".ignore_radio").click(function(){("y"===this.value||"n"===this.value)&&access_edit_ajax(b.find(e+this.value+"]").filter(":not(.ignore_radio)"));a(this).attr("checked",!1);return!1})}function i(b,c,e){var h=a('<tr class="accessRowHeader"><td colspan="6">'+d+"</td></tr>");h.find(".no_auth_bounce").val(e.no_auth_bounce);h.find(".no_auth_bounce").attr({id:"no_auth_bounce_"+
b,name:"no_auth_bounce_"+b});h.find(".enable_http_auth").val(e.enable_http_auth);h.find(".enable_http_auth").attr({id:"enable_http_auth_"+b,name:"enable_http_auth_"+b});h.find(".template_route").val(e.template_route);h.find(".template_route").attr({id:"template_route_"+b,name:"template_route_"+b});h.find(".route_required").val(e.route_required);h.find(".route_required").attr({id:"route_required_"+b,name:"route_required_"+b});set_radio_buttons(h,b);a.each(e.access,function(a,c){var e=h.find("#access_"+
a+"_"+b+"_y"),g=h.find("#access_"+a+"_"+b+"_n");!0===c.access?(e.attr("checked","checked"),g.attr("checked",!1)):(g.attr("checked","checked"),e.attr("checked",!1))});f(h,b);a(c).addClass("highlightRow");a(c).after(h);h.find(".accessTable").tablesorter({widgets:["zebra"]});c.data("accessRow",h)}function j(b,g){var e=a('<tr class="accessRowHeader"><td colspan="6">'+c+"</td></tr>");e.find("select").each(function(){var b=a(this);switch(this.name){case "template_type":b.val(g.type);break;case "cache":b.val(g.cache);
break;case "allow_php":b.val(g.allow_php);break;case "php_parse_location":b.val(g.php_parsing)}b.attr("name",this.name+"_"+g.id)});e.find(".template_name").val(g.name);"index"===g.name&&e.find(".template_name").attr({readonly:"readonly"});e.find(".refresh").val(g.refresh);e.find(".hits").val(g.hits);e.data("ajax_ids",{id:g.id,group_id:g.group_id});b.data("prefsRow",e);a(b).addClass("highlightRow");a(b).after(e)}var b,k,l;c=a("#prefRowTemplate").html();d=a("#accessRowTemplate").html();!c||!d?(b=a("#templateAccess, #templatePreferences"),
k=a("input:hidden[name=template_id]").val(),l=a("input:hidden[name=group_id]").val(),a("#templatePreferences").data("ajax_ids",{id:k,group_id:l}),f(a("#templateAccess")),b.find("input:text").unbind("blur.manager_updated").bind("blur.manager_updated",template_edit_ajax),b.find("input:radio").unbind("click.manager_updated").bind("click.manager_updated",template_edit_ajax),b.find("select").unbind("change.manager_updated").bind("change.manager_updated",template_edit_ajax)):(a("#prefRowTemplate, #accessRowTemplate").remove(),
EE.manager={refreshPrefs:function(a){refresh_prefs_ajax(a)},showPrefsRow:function(b,c){var e=a(c).parent().parent();hideRow(e,"prefsRow")||(j(e,b),bind_prefs_events());return!1},showAccessRow:function(b,c,e){e=a(e).parent().parent();hideRow(e,"accessRow")||(i(b,e,c),bind_prefs_events(),e.trigger("applyWidgets"));return!1}})});a(".last_edit").css("opacity",0).show();a("#template_details").hover(function(){a(".last_edit").animate({opacity:1},50)},function(){a(".last_edit").animate({opacity:0},50)});
a(document).ready(function(){if(EE.manager&&EE.manager.warnings){a(".warning_details").hide();a(".toggle_warning_details").click(function(){a(".warning_details").hide();a("#wd_"+this.id.substr(3)).show();return!1});var c=a("#template_data"),d,j;j=function(b,c,d){var f="";d&&1<d.length&&(f='<select name="fr_options" id="fr_options"></select>');a.ee_notice('<div style="padding: 5px;"><label>Find:</label> <input name="fr_find" id="fr_find" type="text" value="" /> <label>Replace:</label> <input type="text" name="fr_replace" id="fr_replace" value=""/> '+
f+'</div><div style="padding: 5px;"><button class="submit" id="fr_find_btn">Find Next</button> <button class="submit" id="fr_replace_btn">Replace</button> <button class="submit" id="fr_replace_all_btn">Replace All</button> <label><input name="fr_replace_closing_tags" id="fr_replace_closing_tags" type="checkbox" /> Include Closing Tags</label></div>',{type:"custom",open:!0,close_on_click:!1});a("#fr_find").val(b);a("#fr_replace").val(c);a("#fr_replace_closing_tags").attr("checked",!1);""!==f&&(a("#fr_options").append(a(d)),
a("#fr_options").click(function(){a("#fr_find").val(a(this).val());a("#fr_find_btn").click()}));b&&a("#fr_find_btn").click()};a("#fr_find_btn").live("click",function(){var b=a("#fr_find").val();d=c.selectNext(b).scrollToCursor()});a("#fr_replace_btn").live("click",function(){var b=a("#fr_find").val(),c=a("#fr_replace").val();d.getSelectedText()===b&&d.replaceWith(c)});a("#fr_replace_all_btn").live("click",function(){var b=a("#fr_find").val(),d=a("#fr_replace").val();""!==jQuery.trim(b)&&(c.val(c.val().split(b).join(d)),
a("#fr_replace_closing_tags").attr("checked")&&("{"===b[0]&&"{/"!==b.substr(0,2)&&(b="{/"+b.substr(1)),"{"===d[0]&&"{/"!==d.substr(0,2)&&(d="{/"+d.substr(1)),""!==jQuery.trim(b)&&c.val(c.val().split(b).join(d))))});a(".find_and_replace").click(function(){var a=this.id.substr(8),c="{exp:"+a,d="{exp:"+EE.manager.warnings[a].suggestion,f=EE.manager.warnings[a].full_tags,g=Array(new Option(c,c)),e;if(f&&1<f.length)for(e=0;e<f.length;e++)a="{"+f[e]+"}",g.push(new Option(a,a));"{exp:"===d&&(d="");j(c,d,
g);return!1})}});a("#template_keywords_reset").click(function(){a("#template_keywords").val("");a(".search form").submit()})})(jQuery);
