(function(f){var d=f("a[href*=edit_toolset]:not(.addTab)"),i=f('<div id="rte_toolset_editor_modal"><div class="contents"/></div>');i.dialog({width:600,height:435,resizable:false,position:["center","center"],modal:true,draggable:true,autoOpen:false,zIndex:99999,open:function(o,n){g()}});function b(n){f.get(n,function(o){i.find(".contents").html(f("#mainContent .contents",o).html()).find("div.heading").remove().end().end().dialog("option","title",f("#mainContent .edit",o).text()).dialog("open")})}if(d.length){d.click(function(o){o.preventDefault();var n=f(this).closest("a");b(n.attr("href"))})}var h=f("#registerUser select#rte_toolset_id").change(m),l=f('<input type="button" class="submit"/>').css("margin-left","5px").val(EE.rte.edit_text);function c(){i.dialog("option",{height:365});var n=EE.rte.toolset_builder_url.replace(/&amp;/g,"&");if(h.find("option:selected").text()==EE.rte.custom_toolset_text){if(h.val()!="new"){n+="&rte_toolset_id="+h.val()}b(n)}}function m(){if(h.find("option:selected").text()==EE.rte.custom_toolset_text){h.parent().append(l);if(h.val()=="new"){c()}}else{l.remove()}}m();h.parent().delegate("input.submit","click",c);var a=f("#null"),k=a,j=a;function g(){$error=f('<div class="notice"/>').text(EE.rte.name_required);f("body").on("click",".rte-tool",function(n){f(this).toggleClass("rte-tool-active")});f("#rte-tools-selected, #rte-tools-unused").sortable({connectWith:".rte-tools-connected",containment:".rte-toolset-builder",placeholder:"rte-tool-placeholder",revert:200,tolerance:"pointer",beforeStop:function(o,n){f(n.item).replaceWith(n.helper.children().removeClass("rte-tool-active"))},helper:function(p,o){var n=f(".rte-tool-active");if(!n.length){n=f(o).addClass("rte-tool-active")}return f("<div/>").attr("id","rte-drag-helper").css("opacity",0.7).append(n.clone())},receive:function(o,n){f(n.sender).parent().find(".rte-tool-active").addClass("rte-tool-remove")},start:function(o,n){f(this).children(".ui-sortable-placeholder").removeClass("rte-tool-active");f(this).children(".rte-tool-active").hide().addClass("rte-tool-remove")},stop:function(){f(".rte-tool-remove").remove()}});f("#rte-toolset-name").parents("form").submit(function(r){$error.remove();r.preventDefault();e();var q=f(this),t=f("#rte-toolset-name"),p=t.val(),n=EE.rte.validate_toolset_name_url.replace(/&amp;/g,"&"),o=q.attr("action"),s=o.replace(/.*?rte_toolset_id=(\d+)/,"$1");s=f.isNumeric(s)?"&rte_toolset_id="+s:"";f.get(n+"&name="+p+s,function(u){if(p==""||!u.valid){$error.appendTo(t.parent())}else{f.post(o+"&"+q.serialize(),function(v){i.dialog("close");window.location=window.location})}},"json")})}function e(){var n=[];f("#rte-tools-selected li").each(function(){n.push(f(this).data("tool-id"))});f("#rte-toolset-tools").val(n.join("|"))}if(f("#rte-tools-selected").length){g()}})(jQuery);